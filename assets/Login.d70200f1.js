var le=Object.defineProperty;var K=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var T=(p,r,s)=>r in p?le(p,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):p[r]=s,k=(p,r)=>{for(var s in r||(r={}))te.call(r,s)&&T(p,s,r[s]);if(K)for(var s of K(r))ue.call(r,s)&&T(p,s,r[s]);return p};import{d as oe,u as re,am as se,b as ne,an as ie,a4 as v,e as U,aa as F,ab as P,o as I,f as L,g as t,j as e,N as _,h as a,ao as de,ap as pe,aq as R,ar as O,as as c,ae as f,at as V,a1 as E,l as b,ah as M,ai as W,v as i,a2 as N,a6 as z,S as ve,y,W as ce,au as fe,a8 as me}from"./vendor.b2c28a85.js";import{i as ge,a as D,b as H}from"./index.eddda93d.js";const he={style:{display:"flex","justify-content":"flex-end"}},we=i(" \u767B\u5F55 "),be={style:{display:"flex","justify-content":"flex-end"}},ye=i("\u540C\u6E90"),_e=i("\u5916\u6E90"),Ne=i("://"),Se=i(":"),ke=i("/"),Ue=i("\u4EC5\u5BF9\u672C\u6B21\u4F1A\u8BDD\u751F\u6548"),Ie=i("\u4F5C\u4E3A\u5E38\u89C4\u8BBE\u7F6E"),Re=i("\u4FDD\u5B58"),Ae=i("\u4E0D\u80FD\u6B63\u5E38\u5DE5\u4F5C\u4E86\uFF1F\u70B9\u6211\u91CD\u7F6E");var Ce=oe({setup(p){const r=ge(),s=re(),G=se(),J=ne(),A=ie(),o=v({id:2019e9,username:"Hello",realName:"",password:"",passwordRepeat:"",collegeId:1}),m=v(!1),q=v(null),g=v(!0),h=v("login"),x=v([]),Q=U(()=>x.value.map(n=>({value:n.id,label:n.name})));let $=!0;F(()=>h.value,()=>{if($&&h.value==="source"){$=!1,A.warning({title:"\u6362\u6E90",content:'\u5BF9"API\u6E90"\u505A\u51FA\u4FEE\u6539\u5C06\u51B3\u5B9A\u7CFB\u7EDF\u5411\u4F55\u5904\u7684\u670D\u52A1\u5668\u8BF7\u6C42\u6570\u636E\u3002\u8BBE\u7F6E\u4E0D\u5F53\u4F1A\u5BFC\u81F4\u60A8\u65E0\u6CD5\u6B63\u5E38\u4F7F\u7528\u3002\u5982\u679C\u60A8\u4E0D\u77E5\u9053\u8FD9\u610F\u5473\u7740\u4EC0\u4E48\uFF0C\u5EFA\u8BAE\u4E0D\u8981\u5BF9\u6B64\u4F5C\u51FA\u6539\u52A8\u3002',duration:1e4});return}});const X=document.location.origin,d=v(k({},r.state.apiSource));F(r.state.apiSource,()=>d.value=k({},r.state.apiSource));const w=v(!0),Y=U(()=>["http","https"].map(n=>({value:n,label:n}))),C=U(()=>r.getters["apiSource/baseUrl"]);function Z(){r.commit("apiSource/saveApiSource",{apiSource:d.value,forLocal:!w.value}),B(w.value)}function ee(){r.commit("apiSource/saveApiSource",{apiSource:H,forLocal:!0}),r.commit("apiSource/saveApiSource",{apiSource:H,forLocal:!1}),B(!1)}function B(n){A.create({type:n?"info":"warning",title:"\u5DF2\u6362\u6E90",content:`\u60A8\u7684API\u6E90\u5DF2\u7ECF\u66F4\u6539\u4E3A${C.value}\uFF0C\u5237\u65B0\u9875\u9762\u751F\u6548\u3002${n?"\u6B64\u6E90\u4EC5\u5728\u5F53\u524D\u4F1A\u8BDD\u6709\u6548\u3002":"\u8BF7\u6CE8\u610F\uFF0C\u8BE5\u8BBE\u7F6E\u5168\u5C40\u6709\u6548\u3002"}`,duration:5e3,action:()=>a(b,{text:!0,type:"primary",onClick:()=>document.location.reload()},{default:()=>[i("\u5237\u65B0")]})})}P(()=>{r.dispatch("fetchColleges").then(()=>{x.value=r.state.colleges})});const j={id:{required:!0,pattern:/^.{9,16}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5B66\u53F7",trigger:"input"},username:{required:!0,pattern:/^.{5,20}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u7528\u6237\u540D",trigger:"input"},realName:{required:!0,pattern:/^.{1,15}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",trigger:"input"},password:{required:!0,pattern:/^.{6,}$/,message:"\u8BF7\u8F93\u5165\u5BC6\u7801, \u81F3\u5C116\u4F4D",trigger:"input"},passwordRepeat:[{required:!0,message:"\u8BF7\u786E\u8BA4\u5BC6\u7801",trigger:["input","blur"]},{message:"\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u81F4",trigger:"input",validator(n,l,u){return o.value.password.startsWith(l)&&o.value.password.length>=l.length}},{message:"\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u6837",trigger:["blur","password-input"],validator(n,l,u){return o.value.password===l}}],collegeId:{required:!0,message:"\u8BF7\u9009\u62E9\u5B66\u9662",trigger:"input",pattern:/^.{1,}$/}};async function S(){m.value=!0;try{const n=await r.dispatch("login",o.value),l=await r.dispatch("fetchUserInfo");J.push({path:G.query.redirect||"/"}),s.info(`\u767B\u5F55\u6210\u529F\uFF0C\u6B22\u8FCE\u60A8\uFF1A${l.realName}\uFF01`)}catch(n){s.error(`\u767B\u5F55\u5931\u8D25\uFF01${n.message}`)}m.value=!1}async function ae(){var n;try{await((n=q.value)==null?void 0:n.validate())}catch{return}m.value=!0;try{await D.register({id:o.value.id,username:o.value.username,realName:o.value.realName,collegeId:o.value.collegeId,password:o.value.password})?(s.success("\u6CE8\u518C\u6210\u529F\uFF01"),h.value="login"):s.error("\u6CE8\u518C\u5931\u8D25\uFF01")}catch(l){s.error(`\u6CE8\u518C\u5931\u8D25\uFF01${l.message}`)}m.value=!1}return P(async()=>{r.state.login.loginReason&&s.error(r.state.login.loginReason),await D.canRegister()||(g.value=!1)}),(n,l)=>(I(),L(e(_),{vertical:"",align:"center"},{default:t(()=>[a(e(de),{show:m.value},{default:t(()=>[a(e(me),{title:"\u52A0\u5165\u9009\u8BFE\u7CFB\u7EDF",size:"huge"},{default:t(()=>[a(e(pe),{type:"line",animated:"",value:h.value,"onUpdate:value":l[14]||(l[14]=u=>h.value=u)},{default:t(()=>[a(e(R),{name:"login",tab:"\u767B\u5F55"},{default:t(()=>[a(e(O),{model:o.value,rules:j,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging"},{default:t(()=>[a(e(c),{label:"\u7528\u6237\u540D:",path:"username"},{default:t(()=>[a(e(f),{value:o.value.username,"onUpdate:value":l[0]||(l[0]=u=>o.value.username=u),placeholder:"\u8BF7\u8F93\u5165\u5B66\u53F7\u6216\u59D3\u540D",clearable:"",onKeydown:V(S,["enter"])},null,8,["value","onKeydown"])]),_:1}),a(e(c),{label:"\u5BC6\u7801:",path:"password"},{default:t(()=>[a(e(f),{value:o.value.password,"onUpdate:value":l[1]||(l[1]=u=>o.value.password=u),type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",onKeydown:V(S,["enter"])},null,8,["value","onKeydown"])]),_:1}),E("div",he,[a(e(b),{disabled:!o.value.username||!o.value.password,round:"",type:"primary",onClick:S},{default:t(()=>[we]),_:1},8,["disabled"])])]),_:1},8,["model"])]),_:1}),a(e(R),{name:"register",tab:"\u6CE8\u518C"},{default:t(()=>[a(e(O),{ref_key:"formRef",ref:q,model:o.value,rules:j,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",disabled:!g.value},{default:t(()=>[a(e(c),{label:"\u5B66\u53F7:",path:"id"},{default:t(()=>[a(e(M),{value:o.value.id,"onUpdate:value":l[2]||(l[2]=u=>o.value.id=u),placeholder:"\u8BF7\u8F93\u5165\u5B66\u53F7",clearable:""},null,8,["value"])]),_:1}),a(e(c),{label:"\u7528\u6237\u540D:",path:"username"},{default:t(()=>[a(e(f),{value:o.value.username,"onUpdate:value":l[3]||(l[3]=u=>o.value.username=u),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",clearable:""},null,8,["value"])]),_:1}),a(e(c),{label:"\u59D3\u540D:",path:"realName"},{default:t(()=>[a(e(f),{value:o.value.realName,"onUpdate:value":l[4]||(l[4]=u=>o.value.realName=u),placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",clearable:""},null,8,["value"])]),_:1}),a(e(c),{label:"\u5BC6\u7801:",path:"password"},{default:t(()=>[a(e(f),{value:o.value.password,"onUpdate:value":l[5]||(l[5]=u=>o.value.password=u),type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},null,8,["value"])]),_:1}),a(e(c),{label:"\u786E\u8BA4\u5BC6\u7801:",path:"passwordRepeat"},{default:t(()=>[a(e(f),{value:o.value.passwordRepeat,"onUpdate:value":l[6]||(l[6]=u=>o.value.passwordRepeat=u),type:"password",placeholder:"\u8BF7\u518D\u6B21\u786E\u8BA4\u5BC6\u7801"},null,8,["value"])]),_:1}),a(e(c),{label:"\u5B66\u9662: ",path:"collegeId"},{default:t(()=>[a(e(W),{value:o.value.collegeId,"onUpdate:value":l[7]||(l[7]=u=>o.value.collegeId=u),placeholder:"\u8BF7\u9009\u62E9\u5B66\u9662",options:e(Q)},null,8,["value","options"])]),_:1}),E("div",be,[a(e(b),{round:"",type:g.value?"primary":"error",ghost:"",onClick:ae,disabled:!g.value},{default:t(()=>[i(N(g.value?"\u6CE8\u518C":"\u672A\u5F00\u653E\u6CE8\u518C"),1)]),_:1},8,["type","disabled"])])]),_:1},8,["model","disabled"])]),_:1}),a(e(R),{name:"source",tab:"\u6362\u6E90"},{default:t(()=>[a(e(_),{vertical:"",align:"stretch"},{default:t(()=>[a(e(_),{align:"center"},{default:t(()=>[a(e(z),{value:d.value.sameSource,"onUpdate:value":l[8]||(l[8]=u=>d.value.sameSource=u)},{checked:t(()=>[ye]),unchecked:t(()=>[_e]),_:1},8,["value"]),d.value.sameSource?(I(),L(e(y),{key:1},{default:t(()=>[i(N(e(X)),1)]),_:1})):(I(),ve(ce,{key:0},[a(e(W),{value:d.value.protocol,"onUpdate:value":l[9]||(l[9]=u=>d.value.protocol=u),options:e(Y),placeholder:"\u534F\u8BAE"},null,8,["value","options"]),a(e(y),null,{default:t(()=>[Ne]),_:1}),a(e(f),{value:d.value.host,"onUpdate:value":l[10]||(l[10]=u=>d.value.host=u),placeholder:"\u4E3B\u673A\u5730\u5740"},null,8,["value"]),a(e(y),null,{default:t(()=>[Se]),_:1}),a(e(M),{value:d.value.port,"onUpdate:value":l[11]||(l[11]=u=>d.value.port=u),placeholder:"\u7AEF\u53E3\u53F7"},null,8,["value"]),a(e(y),null,{default:t(()=>[ke]),_:1})],64)),a(e(f),{value:d.value.base,"onUpdate:value":l[12]||(l[12]=u=>d.value.base=u),placeholder:"API\u57FA\u8DEF\u5F84"},null,8,["value"]),a(e(fe),null,{trigger:t(()=>[a(e(z),{value:w.value,"onUpdate:value":l[13]||(l[13]=u=>w.value=u)},{checked:t(()=>[Ue]),unchecked:t(()=>[Ie]),_:1},8,["value"])]),default:t(()=>[i(" "+N(w.value?"\u60A8\u5728\u5176\u4ED6\u7A97\u53E3\u8BBF\u95EE\u672C\u7CFB\u7EDF\u4E0D\u4F1A\u91C7\u7528\u5F53\u524D\u8BBE\u7F6E\uFF0C\u4ED6\u4EEC\u4E0D\u4F1A\u53D7\u5230\u5F71\u54CD\u3002":"\u8BE5\u8BBE\u7F6E\u5C06\u4FDD\u5B58\u4E0B\u6765\uFF0C\u6240\u6709\u7A97\u53E3\u90FD\u53EF\u4EE5\u4F1A\u91C7\u7528\u3002"),1)]),_:1})]),_:1}),a(e(_),{justify:"end",align:"center"},{default:t(()=>[a(e(y),null,{default:t(()=>[i("\u5F53\u524D\u6E90\uFF1A"+N(e(C)),1)]),_:1}),a(e(b),{type:"primary",round:"",ghost:"",onClick:Z},{default:t(()=>[Re]),_:1}),a(e(b),{round:"",ghost:"",onClick:ee},{default:t(()=>[Ae]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["show"])]),_:1}))}});export{Ce as default};
