var Ne=Object.defineProperty,Ie=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var _e=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var L=(c,p,s)=>p in c?Ne(c,p,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[p]=s,T=(c,p)=>{for(var s in p||(p={}))_e.call(p,s)&&L(c,s,p[s]);if(J)for(var s of J(p))Ce.call(p,s)&&L(c,s,p[s]);return c},W=(c,p)=>Ie(c,ke(p));import{d as Se,u as xe,a9 as Ye,aD as X,a4 as i,e as qe,ab as Re,aa as Te,o as x,f as Y,g as u,j as a,aj as ze,h as e,ak as Ae,N as g,l as w,m as I,af as Z,ax as ee,aE as Fe,$ as $e,a0 as De,ah as z,aF as Be,ae as k,ai as A,y as F,V as Pe,a8 as ae,ar as Ee,as as h,v as f,a2 as _,n as le,a1 as je,aC as te,ao as Me,at as Oe,aG as re,aH as $,aI as Ve}from"./vendor.b2c28a85.js";import{_ as Ge}from"./ProfileEditor.380ad268.js";import{i as Ke,R as b,a as U}from"./index.eddda93d.js";import"./UserBrief.494b4d44.js";const Qe=f(" \u589E\u52A0 "),He=f(" \u7F16\u8F91 "),Je=f(" \u5E74 "),Le=f("\u5230"),We=f(" \u5E74 "),Xe=f("\u67E5\u8BE2"),Ze=f("\u91CD\u7F6E"),ea={style:{display:"flex","justify-content":"flex-end"}},aa=f(" \u6DFB\u52A0\u7528\u6237 "),la=f("\u672A\u627E\u5230\u8BE5\u7528\u6237");var oa=Se({setup(c){const p=Ke(),s=xe(),ue=Ye(),d=X({page:1,pageCount:0,pageSize:10,itemCount:100,pageSizes:[10,20,30],showQuickJumper:!0,showSizePicker:!0,onChange:t=>{d.page=t},onUpdatePageSize:t=>{d.pageSize=t,d.page=1},prefix({itemCount:t}){return`\u5171 ${t} \u6761`}}),O=i([]),D=X({}),C=i(!0),ne=i([{key:"id",title:"ID"},{key:"username",title:"\u7528\u6237\u540D"},{key:"realName",title:"\u771F\u5B9E\u59D3\u540D"},{key:"college.name",title:"\u5B66\u9662"},{key:"entranceYear",title:"\u5165\u5B66\u5E74\u4EFD"},{key:"createdAt",title:"\u6CE8\u518C\u65F6\u95F4",render(t,l){const r=t;return e(re,{time:new Date(r.createdAt)},null)}},{key:"updatedAt",title:"\u66F4\u65B0\u65F6\u95F4",render(t,l){const r=t;return e(re,{time:new Date(r.updatedAt)},null)}},{key:"role",title:"\u89D2\u8272",render(t,l){return t.role===b.Admin?e($,{type:"warning"},{default:()=>[f("\u7BA1\u7406\u5458")]}):t.role===b.Teacher?e($,{type:"primary"},{default:()=>[f("\u6559\u5E08")]}):t.role===b.Student?e($,{type:"info"},{default:()=>[f("\u5B66\u751F")]}):e($,{type:"error"},{default:()=>[f("ERR")]})}},{key:"actions",title:"\u64CD\u4F5C",render(t,l){const r=t,be={icon:()=>e(I,null,{default:()=>[e(ee,null,null)]})},Ue={icon:()=>e(I,null,{default:()=>[e(Ve,null,null)]})};return e(g,null,{default:()=>[e(w,{round:!0,ghost:!0,type:"info",onClick:()=>{S.value=r.id+"",q.value=!0,v.value=r}},be),e(w,{round:!0,ghost:!0,type:"error",loading:!!D[r.id],onClick:()=>ie(r)},Ue)]})}}]),V={id:0,username:"",realName:"",roles:[],collegesId:[],entranceYearFrom:0,entranceYearTo:0,page:0,size:0},o=i(T({},V));async function N(t,l){C.value=!0,U.fetchUserList(W(T({},o.value),{page:t,size:l})).then(r=>{O.value=r.contents,d.page=r.pageNo,d.itemCount=r.total,d.pageCount=Math.ceil(r.total/l),C.value=!1}).catch(r=>{s.error("\u83B7\u53D6\u7528\u6237\u5217\u8868\u5931\u8D25\uFF01"+r.message),C.value=!1})}async function se(t){N(t,d.pageSize)}async function oe(t){N(d.page,t)}function de(t){t&&(o.value.entranceYearTo=t>o.value.entranceYearTo?t:o.value.entranceYearTo)}function ie(t){ue.warning({title:"\u5220\u9664",content:`\u786E\u8BA4\u5220\u9664\u7528\u6237"${t.realName}(${t.username})"\u561B\uFF1F`,positiveText:"\u786E\u8BA4",negativeText:"\u53D6\u6D88",async onPositiveClick(){try{D[t.id]=!0,await U.deleteUser(t.id),s.info(`\u7528\u6237"${t.realName}(${t.username})"\u5DF2\u88AB\u5220\u9664\uFF01`),N(d.page,d.pageSize)}catch(l){s.error(`\u5220\u9664\u7528\u6237\u5931\u8D25\uFF01${l.message}`)}finally{D[t.id]=!1}}})}const B=i([]),G=qe(()=>B.value.map(t=>({value:t.id,label:t.name})));Re(async()=>{N(d.page,d.pageSize),p.dispatch("fetchColleges").then(()=>{B.value=p.state.colleges})});const pe=i({username:"",realName:"",collegeId:0,role:b.Student,entranceYear:new Date().getFullYear()}),S=i(""),P=i(!1),v=i(),q=i(!1);Te(()=>v,()=>{pe.value={username:v.value.username,realName:v.value.realName,collegeId:v.value.college.id,role:v.value.role,entranceYear:v.value.entranceYear}});async function ve(){S.value="",v.value=void 0,q.value=!0}async function fe(){P.value=!0;try{v.value=await U.fetchOtherUserInfo(S.value)}catch{v.value=void 0}P.value=!1}const E=i(!1);async function ge(t){try{E.value=!0,v.value=await U.updateUserInfo(v.value.id,t),s.success("\u66F4\u65B0\u4E2A\u4EBA\u4FE1\u606F\u6210\u529F\uFF01"),N(d.page,d.pageSize)}catch(l){s.error("\u66F4\u65B0\u4E2A\u4EBA\u4FE1\u606F\u5931\u8D25\uFF01"+l.message)}finally{E.value=!1}}const j=i(!1);async function ce(t){try{j.value=!0,await U.updateUserPassword(v.value.id,t),s.success("\u4FEE\u6539\u5BC6\u7801\u6210\u529F\uFF01")}catch(l){s.error("\u4FEE\u6539\u5BC6\u7801\u5931\u8D25\uFF01"+l.message)}finally{j.value=!1}}const K=[{value:b.Student,label:"\u5B66\u751F"},{value:b.Teacher,label:"\u6559\u5E08"},{value:b.Admin,label:"\u7BA1\u7406\u5458"}],M=i(!1),R=i(!1),Q=new Date,n=i({id:parseInt(Q.getFullYear()+Q.getTime().toString().substring(0,9)),username:"",realName:"",collegeId:1,password:"",passwordRepeat:"",role:b.Student,entranceYear:new Date().getFullYear()}),me={id:[{required:!0,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5B66\u53F7",trigger:["input","blur"],validator(t,l,r){return l>0}},{required:!0,message:"\u5B66\u53F7\u5DF2\u88AB\u4F7F\u7528",trigger:"blur",validator(t,l,r){return m.value===void 0||m.value.id!==l}}],username:[{required:!0,pattern:/^.{5,20}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u7528\u6237\u540D",trigger:"input"},{required:!0,message:"\u7528\u6237\u540D\u5DF2\u88AB\u4F7F\u7528",trigger:"blur",validator(t,l,r){return y.value===void 0||y.value.username!==l}}],realName:{required:!0,pattern:/^.{1,15}$/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u59D3\u540D",trigger:"input"},password:{required:!0,pattern:/^.{6,}$/,message:"\u8BF7\u8F93\u5165\u5BC6\u7801, \u81F3\u5C116\u4F4D",trigger:"input"},passwordRepeat:[{required:!0,message:"\u8BF7\u786E\u8BA4\u5BC6\u7801",trigger:["input","blur"]},{message:"\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u81F4",trigger:"input",validator(t,l,r){return n.value.password.startsWith(l)&&n.value.password.length>=l.length}},{message:"\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u6837",trigger:["blur","password-input"],validator(t,l,r){return n.value.password===l}}],collegeId:{required:!0,message:"\u8BF7\u9009\u62E9\u5B66\u9662",trigger:"input",pattern:/^.{1,}$/}},H=i(null);async function ye(){var t;try{await((t=H.value)==null?void 0:t.validate())}catch{return}try{if(R.value=!0,!await U.newUser(n.value))throw new Error("");s.success("\u6DFB\u52A0\u65B0\u7528\u6237\u6210\u529F\uFF01")}catch(l){s.error("\u6DFB\u52A0\u7528\u6237\u5931\u8D25\uFF01"+l.message)}finally{R.value=!1}}const m=i();async function we(){try{const t=await U.fetchOtherUserInfo(n.value.id);(t==null?void 0:t.id)===n.value.id&&(m.value=t)}catch{m.value=void 0}}const y=i();async function he(){try{const t=await U.fetchOtherUserInfo(n.value.username);(t==null?void 0:t.username)===n.value.username&&(y.value=t)}catch{y.value=void 0}}return(t,l)=>(x(),Y(a(ze),{cols:12,style:{"margin-bottom":"20px"}},{default:u(()=>[e(a(Ae),{span:10,offset:1},{default:u(()=>[e(a(g),{vertical:""},{default:u(()=>[e(a(g),{justify:"space-between"},{default:u(()=>[e(a(g),null,{default:u(()=>[e(a(w),{ghost:"",type:"primary",onClick:l[0]||(l[0]=r=>M.value=!0)},{icon:u(()=>[e(a(I),null,{default:u(()=>[e(a(Z))]),_:1})]),default:u(()=>[Qe]),_:1}),e(a(w),{ghost:"",type:"info",onClick:ve},{icon:u(()=>[e(a(I),null,{default:u(()=>[e(a(ee))]),_:1})]),default:u(()=>[He]),_:1})]),_:1}),e(a(g),null,{default:u(()=>[e(a(w),{round:"",ghost:"",onClick:l[1]||(l[1]=()=>N(a(d).page,a(d).pageSize)),loading:C.value},{icon:u(()=>[e(a(I),null,{default:u(()=>[e(a(Fe))]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),e(a($e),{style:{margin:"15px 0"}},{default:u(()=>[e(a(De),{title:"\u7B5B\u9009"},{default:u(()=>[e(a(g),{vertical:"",align:"stretch"},{default:u(()=>[e(a(z),{value:o.value.id,"onUpdate:value":l[2]||(l[2]=r=>o.value.id=r),"show-button":!1,placeholder:"\u5B66\u53F7",clearable:""},{prefix:u(()=>[e(a(I),null,{default:u(()=>[e(a(Be))]),_:1})]),_:1},8,["value"]),e(a(k),{value:o.value.username,"onUpdate:value":l[3]||(l[3]=r=>o.value.username=r),placeholder:"\u7528\u6237\u540D",clearable:""},null,8,["value"]),e(a(k),{value:o.value.realName,"onUpdate:value":l[4]||(l[4]=r=>o.value.realName=r),placeholder:"\u59D3\u540D",clearable:""},null,8,["value"]),e(a(A),{value:o.value.roles,"onUpdate:value":l[5]||(l[5]=r=>o.value.roles=r),options:K,placeholder:"\u89D2\u8272",multiple:"",clearable:""},null,8,["value"]),e(a(A),{value:o.value.collegesId,"onUpdate:value":l[6]||(l[6]=r=>o.value.collegesId=r),options:a(G),placeholder:"\u5B66\u9662",multiple:"",clearable:""},null,8,["value","options"]),e(a(g),{align:"center"},{default:u(()=>[e(a(z),{value:o.value.entranceYearFrom,"onUpdate:value":[l[7]||(l[7]=r=>o.value.entranceYearFrom=r),de],max:9999,"show-button":!1,placeholder:"\u5165\u5B66\u5E74\u4EFD"},{suffix:u(()=>[Je]),_:1},8,["value"]),e(a(F),null,{default:u(()=>[Le]),_:1}),e(a(z),{value:o.value.entranceYearTo,"onUpdate:value":l[8]||(l[8]=r=>o.value.entranceYearTo=r),min:o.value.entranceYearFrom,max:9999,"show-button":!1,placeholder:"\u5165\u5B66\u5E74\u4EFD"},{suffix:u(()=>[We]),_:1},8,["value","min"])]),_:1}),e(a(g),{justify:"end"},{default:u(()=>[e(a(w),{type:"primary",onClick:l[9]||(l[9]=()=>N(1,a(d).pageSize))},{default:u(()=>[Xe]),_:1}),e(a(w),{onClick:l[10]||(l[10]=()=>o.value=T({},V))},{default:u(()=>[Ze]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(a(Pe),{remote:"",columns:ne.value,data:O.value,pagination:a(d),loading:C.value,"onUpdate:page":se,"onUpdate:pageSize":oe},null,8,["columns","data","pagination","loading"])]),_:1}),e(a(te),{show:M.value,"onUpdate:show":l[18]||(l[18]=r=>M.value=r)},{default:u(()=>[e(a(ae),{style:{width:"50%"},title:"\u6DFB\u52A0",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:u(()=>[e(a(Ee),{ref_key:"formRef",ref:H,model:n.value,rules:me,"label-placement":"left","label-width":"auto","require-mark-placement":"right-hanging",disabled:R.value},{default:u(()=>[e(a(h),{label:"\u5B66\u53F7:",path:"id"},{default:u(()=>[e(a(g),{align:"center"},{default:u(()=>[e(a(z),{value:n.value.id,"onUpdate:value":[l[11]||(l[11]=r=>n.value.id=r),we],placeholder:"\u8BF7\u8F93\u5165\u5B66\u53F7",clearable:"",min:1,max:8888888888888888},null,8,["value"]),m.value!==void 0?(x(),Y(a(F),{key:0,type:"error"},{default:u(()=>[f(_(m.value.realName)+"("+_(m.value.id)+" - "+_(m.value.username)+") ",1)]),_:1})):le("",!0)]),_:1})]),_:1}),e(a(h),{label:"\u7528\u6237\u540D:",path:"username"},{default:u(()=>[e(a(g),{align:"center"},{default:u(()=>[e(a(k),{value:n.value.username,"onUpdate:value":[l[12]||(l[12]=r=>n.value.username=r),he],placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",clearable:""},null,8,["value"]),y.value!==void 0?(x(),Y(a(F),{key:0,type:"error"},{default:u(()=>[f(_(y.value.realName)+"("+_(y.value.id)+" - "+_(y.value.username)+") ",1)]),_:1})):le("",!0)]),_:1})]),_:1}),e(a(h),{label:"\u5BC6\u7801:",path:"password"},{default:u(()=>[e(a(k),{value:n.value.password,"onUpdate:value":l[13]||(l[13]=r=>n.value.password=r),type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801"},null,8,["value"])]),_:1}),e(a(h),{label:"\u786E\u8BA4\u5BC6\u7801:",path:"passwordRepeat"},{default:u(()=>[e(a(k),{value:n.value.passwordRepeat,"onUpdate:value":l[14]||(l[14]=r=>n.value.passwordRepeat=r),type:"password",placeholder:"\u8BF7\u518D\u6B21\u786E\u8BA4\u5BC6\u7801"},null,8,["value"])]),_:1}),e(a(h),{label:"\u59D3\u540D:",path:"realName"},{default:u(()=>[e(a(k),{value:n.value.realName,"onUpdate:value":l[15]||(l[15]=r=>n.value.realName=r),placeholder:"\u8BF7\u8F93\u5165\u59D3\u540D",clearable:""},null,8,["value"])]),_:1}),e(a(h),{label:"\u5B66\u9662: ",path:"collegeId"},{default:u(()=>[e(a(A),{value:n.value.collegeId,"onUpdate:value":l[16]||(l[16]=r=>n.value.collegeId=r),placeholder:"\u8BF7\u9009\u62E9\u5B66\u9662",options:a(G)},null,8,["value","options"])]),_:1}),e(a(h),{label:"\u89D2\u8272: ",path:"role"},{default:u(()=>[e(a(A),{value:n.value.role,"onUpdate:value":l[17]||(l[17]=r=>n.value.role=r),placeholder:"\u8BF7\u9009\u62E9\u89D2\u8272",options:K},null,8,["value"])]),_:1}),je("div",ea,[e(a(w),{round:"",ghost:"",type:"primary",onClick:ye,loading:R.value},{icon:u(()=>[e(a(I),null,{default:u(()=>[e(a(Z))]),_:1})]),default:u(()=>[aa]),_:1},8,["loading"])])]),_:1},8,["model","disabled"])]),_:1})]),_:1},8,["show"]),e(a(te),{show:q.value,"onUpdate:show":l[20]||(l[20]=r=>q.value=r)},{default:u(()=>[e(a(ae),{style:{width:"80%"},title:"\u7F16\u8F91",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{default:u(()=>[e(a(Me),{show:P.value},{default:u(()=>[e(a(g),{vertical:""},{default:u(()=>[e(a(h),{label:"\u5B66\u751FID:","label-placement":"left",style:{"max-width":"50%"}},{default:u(()=>[e(a(k),{value:S.value,"onUpdate:value":l[19]||(l[19]=r=>S.value=r),placeholder:"\u8BF7\u8F93\u5165\u5B66\u53F7, \u56DE\u8F66\u67E5\u8BE2",clearable:"",onKeydown:Oe(fe,["enter"])},null,8,["value","onKeydown"])]),_:1}),v.value?(x(),Y(Ge,{key:0,user:v.value,colleges:B.value,"updating-info":E.value,"updating-password":j.value,onUpdateInfo:ge,onUpdatePassword:ce},null,8,["user","colleges","updating-info","updating-password"])):(x(),Y(a(F),{key:1},{default:u(()=>[la]),_:1}))]),_:1})]),_:1},8,["show"])]),_:1})]),_:1},8,["show"])]),_:1})]),_:1}))}});export{oa as default};
