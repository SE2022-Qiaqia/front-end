var q=Object.defineProperty;var M=(e,t,s)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var N=(e,t,s)=>(M(e,typeof t!="symbol"?t+"":t,s),s);import{a as z,c as D,i as V,d as T,u as H,b as j,e as B,w as Q,o as F,f as k,g as c,h as o,j as n,N as C,k as G,l as K,m as f,P as Z,n as X,p as A,q as Y,r as W,s as ee,t as te,v as h,x as se,y as ae,z as S,A as oe,T as re,B as ne,C as ue,D as ie,E as ce,F as le,G as de,H as pe,I as he,J as fe,K as ge,L as me,M as Se,O as ye,Q as _e,R as we}from"./vendor.b2c28a85.js";const ve=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const i of u.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function a(r){if(r.ep)return;r.ep=!0;const u=s(r);fetch(r.href,u)}};ve();var L=(e=>(e[e.Ok=0]="Ok",e[e.Fail=-1]="Fail",e[e.NotFound=-2]="NotFound",e[e.Conflict=-3]="Conflict",e[e.Unauthorized=-4]="Unauthorized",e[e.Internal=-5]="Internal",e[e.QuotaExceeded=-6]="QuotaExceeded",e))(L||{});function Ue(e){switch(e){case 0:return"\u5468\u65E5";case 1:return"\u5468\u4E00";case 2:return"\u5468\u4E8C";case 3:return"\u5468\u4E09";case 4:return"\u5468\u56DB";case 5:return"\u5468\u4E94";case 6:return"\u5468\u516D"}return console.error("\u9519\u8BEF\u7684 dayOfWeek",e),"<ERR>"}var _=(e=>(e[e.Student=0]="Student",e[e.Teacher=100]="Teacher",e[e.Admin=200]="Admin",e))(_||{}),xe=(e=>(e[e.Sunday=0]="Sunday",e[e.Monday=1]="Monday",e[e.Tuesday=2]="Tuesday",e[e.Wednesday=3]="Wednesday",e[e.Thursday=4]="Thursday",e[e.Friday=5]="Friday",e[e.Saturday=6]="Saturday",e))(xe||{}),Ie="/front-end/assets/logo.2d93ab47.jpg";function $(e){return e.sameSource?document.location.origin+"/"+e.base:`${e.protocol}://${e.host}:${e.port}/${e.base}`}function U(){let e=sessionStorage.getItem("apiSource");return e||(e=localStorage.getItem("apiSource")),e?JSON.parse(e):be}const be={protocol:"http",host:"localhost",port:8080,base:"api/v1",sameSource:!1};class Ee{constructor(t=""){N(this,"token","");N(this,"_axios");this._axios=z.create({baseURL:t,withCredentials:!1}),this._axios.interceptors.request.use(s=>(s.headers.Authorization=`Bearer ${this.token}`,s)),this._axios.interceptors.response.use(s=>{if(s.data.code!=L.Ok)throw new Error(s.data.msg);return s})}async login(t){const s=await this._axios.post("/login",t);return this.token=s.data.data,this.token}async logout(){const t=await this._axios.get("/logout");return this.token="",t.data.data}async register(t){return(await this._axios.post("/register",t)).data.data}async fetchUserInfo(){return(await this._axios.get("/user")).data.data}async fetchOtherUserInfo(t){return(await this._axios.get(`/user/${t}`)).data.data}async updateSelfInfo(t){return(await this._axios.post("/user",t)).data.data}async updateUserInfo(t,s){return(await this._axios.post(`/user/${t}`,s)).data.data}async updatePassword(t){return(await this._axios.post("/user/pwd",{password:t})).data.data}async updateUserPassword(t,s){return(await this._axios.post(`/user/${t}/pwd`,{password:s})).data.data}async newUser(t){return(await this._axios.post("/user/new",t)).data.data}async fetchColleges(t=""){return(await this._axios.post("/college/list",{name:t})).data.data||[]}async newCollege(t=""){return(await this._axios.post("/college/new",{name:t})).data.data}async fetchSemesters(){return(await this._axios.get("/semester/")).data.data||[]}async fetchCurrentSemester(){return(await this._axios.get("/semester/curr")).data.data}async setCurrentSemester(t){return(await this._axios.post("/semester/curr",{id:t})).data.data}async newSemester(t){return(await this._axios.post("/semester/",t)).data.data}async queryCourses(t){return(await this._axios.post("/course/list",t)).data.data}async fetchSchedules(t){return(await this._axios.post("/course/schedules",t)).data.data}async selectCourse(t,s){return(await this._axios.post("/course/select",{studentId:t,courseId:s})).data.data}async unselectCourse(t,s){return(await this._axios.delete("/course/select",{data:{studentId:t,courseId:s}})).data.data}async canRegister(){return(await this._axios.get("/register/enable")).data.data}async enableRegister(t){return(await this._axios.post("/register/enable",{enable:t})).data.data}async fetchUserList(t){return(await this._axios.post("/user/list",t)).data.data}async deleteUser(t){return(await this._axios.delete(`/user/${t}`)).data.data}async updateCourseCommon(t,s){return(await this._axios.put(`/course/${t}`,s)).data.data}async newCourseCommon(t){return(await this._axios.post("/course",t)).data.data}async openCourse(t){return(await this._axios.post("/course/open",t)).data.data}async updateCourseSpecific(t,s){return(await this._axios.put(`/course/spec/${t}`,s)).data.data}}const d=new Ee($(U())),I=Symbol(),Ne={namespaced:!0,state:{loginReason:""},mutations:{setLoginReason(e,t){e.loginReason=t}}},Ae=U(),Be={namespaced:!0,state:Ae,mutations:{saveApiSource(e,t){e.protocol=t.apiSource.protocol,e.host=t.apiSource.host,e.port=t.apiSource.port,e.base=t.apiSource.base,e.sameSource=t.apiSource.sameSource,t.forLocal?localStorage.setItem("apiSource",JSON.stringify(t.apiSource)):sessionStorage.setItem("apiSource",JSON.stringify(t.apiSource))}},getters:{baseUrl(e){return $(e)}}},O=localStorage.getItem("loginToken")||"";d.token=O;const l=D({strict:!1,state:{loginToken:O,user:JSON.parse(localStorage.getItem("user")||"{}"),schedules:JSON.parse(localStorage.getItem("schedules")||"[]"),colleges:JSON.parse(localStorage.getItem("colleges")||"[]"),semesters:JSON.parse(localStorage.getItem("semesters")||"[]"),currentSemester:JSON.parse(localStorage.getItem("currentSemester")||"{}"),routerPushReason:""},modules:{login:Ne,apiSource:Be},mutations:{saveUserInfo(e,t){e.user=t,localStorage.setItem("user",JSON.stringify(t))},saveLoginToken(e,t){e.loginToken=t,d.token=t,localStorage.setItem("loginToken",t)},saveSchedules(e,t){e.schedules=t,localStorage.setItem("schedules",JSON.stringify(t))},saveColleges(e,t){e.colleges=t,localStorage.setItem("colleges",JSON.stringify(t))},saveSemesters(e,{semesters:t,currentSemester:s}){e.semesters=t,e.currentSemester=s,localStorage.setItem("semesters",JSON.stringify(t)),localStorage.setItem("currentSemester",JSON.stringify(s))},saveRouterPushReason(e,t){e.routerPushReason=t},clearRouterPushReason(e){e.routerPushReason=""}},actions:{async login({commit:e},t){e("login/setLoginReason","");try{const s=await d.login(t);return e("saveLoginToken",s),s}catch(s){throw e("saveLoginToken",""),e("saveUserInfo",{}),s}},async logout({commit:e}){try{await d.logout()}catch(t){console.log("\u767B\u51FA\u5931\u8D25",t)}finally{e("saveLoginToken",""),e("saveUserInfo",{}),e("saveSchedules",[]),e("saveColleges",[]),e("saveSemesters",{semesters:[],currentSemester:{}})}},async fetchUserInfo({commit:e,state:t}){if(t.loginToken)try{const s=await d.fetchUserInfo();return e("saveUserInfo",s),s}catch(s){throw e("saveLoginToken",""),e("saveUserInfo",{}),s}},async fetchSchedules({commit:e,state:t}){var a,r;const s=await d.fetchSchedules({userId:((a=t.user)==null?void 0:a.id)||0,semesterIds:(r=t.currentSemester)!=null&&r.id?[t.currentSemester.id]:[]});e("saveSchedules",s)},async fetchColleges({commit:e,state:t}){const s=await d.fetchColleges();e("saveColleges",s)},async fetchSemesters({commit:e,state:t}){const s=await d.fetchSemesters(),a=await d.fetchCurrentSemester();e("saveSemesters",{semesters:s,currentSemester:a})}}});function Fe(){return V(I)}const ke=h(" \u9000\u51FA\u767B\u5F55 ");var Re=T({setup(e){const t=Fe(),s=H(),a=j(),r=B(()=>t.state.user),u="70px",i="20px",g=`calc(${u} + ${i} * 2)`,b=B(()=>{var E,w,m,R;const p=[];return p.push({key:"home",label:()=>o(S("router-link"),{to:"/"},{default:()=>[o(C,{justify:"center",align:"center",style:"margin: 0;","item-style":"display: flex; align-items: center;",size:5},{default:()=>[o(se,{src:Ie,round:!0,size:20},null),o(ae,{type:"info",strong:!0},{default:()=>[h("QiaQia \u9009\u8BFE\u7CFB\u7EDF")]})]})]})}),(E=r.value)!=null&&E.id&&(p.push({key:"profile",label:()=>o(S("router-link"),{to:"profile"},{default:()=>[h("\u4E2A\u4EBA\u4FE1\u606F")]}),icon:()=>o(f,null,{default:()=>[o(oe,null,null)]}),disabled:!((w=r.value)!=null&&w.id)},{key:"courses",label:()=>o(S("router-link"),{to:"courses"},{default:()=>[h("\u8BFE\u7A0B\u7BA1\u7406")]}),icon:()=>o(f,null,{default:()=>[o(re,null,null)]}),disabled:!((m=r.value)!=null&&m.id)}),r.value.role===_.Admin&&p.push({key:"users",label:()=>o(S("router-link"),{to:"users"},{default:()=>[h("\u7528\u6237\u7BA1\u7406")]}),icon:()=>o(f,null,{default:()=>[o(ne,null,null)]}),disabled:((R=r.value)==null?void 0:R.role)!==_.Admin})),p.push({key:"github",label:()=>o("a",{href:"https://github.com/SE2022-Qiaqia"},[h("Github")]),icon:()=>o(f,null,{default:()=>[o("svg",{viewBox:"0 0 24 24"},[o("path",{d:"M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2c2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2a4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6c-.6.6-.6 1.2-.5 2V21",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null)])]})},{key:"docs",label:()=>o("a",{href:"https://se2022-qiaqia.github.io/docs/"},[h("Docs")]),icon:()=>o(f,null,{default:()=>[o(ue,null,null)]})}),p});function J(){t.dispatch("logout").then(()=>{t.state.loginToken?s.error("\u9000\u51FA\u5931\u8D25"):(s.success("\u9000\u51FA\u6210\u529F"),a.push("/login"))}).catch(p=>{s.error("\u9000\u51FA\u5931\u8D25\uFF01"+p.message)})}return Q(()=>{t.state.routerPushReason&&(s.info(t.state.routerPushReason),t.commit("saveRouterPushReason",null))}),(p,E)=>{const w=S("router-view");return F(),k(n(te),{position:"absolute"},{default:c(()=>[o(n(Y),{style:A({position:"absolute",padding:i}),bordered:""},{default:c(()=>[o(n(C),{align:"center",justify:"space-between"},{default:c(()=>{var m;return[o(n(G),{mode:"horizontal",options:n(b)},null,8,["options"]),(m=n(r))!=null&&m.id?(F(),k(n(K),{key:0,text:"",tag:"a",onClick:J},{icon:c(()=>[o(n(f),null,{default:c(()=>[o(n(Z))]),_:1})]),default:c(()=>[ke]),_:1})):X("",!0)]}),_:1})]),_:1},8,["style"]),o(n(ee),{style:A({position:"absolute",top:g,height:`calc(100vh - ${g})`,width:"100vw"})},{default:c(()=>[o(n(W),{style:A({maxHeight:`calc(100vh - ${g})`})},{default:c(()=>[o(w)]),_:1},8,["style"])]),_:1},8,["style"])]),_:1})}}}),Ce=T({setup(e){const t=ie(),s=B(()=>t.value==="dark"?ce:null),a=le(I);return de(I,a),(r,u)=>(F(),k(n(fe),{theme:n(s),locale:n(pe),"date-locale":n(he)},{default:c(()=>[o(n(ge),null,{default:c(()=>[o(n(Se),null,{default:c(()=>[o(n(me),null,{default:c(()=>[o(Re)]),_:1})]),_:1})]),_:1})]),_:1},8,["theme","locale","date-locale"]))}});const Pe="modulepreload",P={},Te="/front-end/",y=function(t,s){return!s||s.length===0?t():Promise.all(s.map(a=>{if(a=`${Te}${a}`,a in P)return;P[a]=!0;const r=a.endsWith(".css"),u=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${u}`))return;const i=document.createElement("link");if(i.rel=r?"stylesheet":Pe,r||(i.as="script",i.crossOrigin=""),i.href=a,document.head.appendChild(i),r)return new Promise((g,b)=>{i.addEventListener("load",g),i.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t())},v="/login",x=ye({history:_e(),routes:[{path:"/",component:()=>y(()=>import("./Home.06497ec4.js"),["assets/Home.06497ec4.js","assets/UserBrief.494b4d44.js","assets/vendor.b2c28a85.js","assets/index.d7c2533d.js"]),meta:{title:"\u9996\u9875",needAuth:!0}},{path:v,component:()=>y(()=>import("./Login.d70200f1.js"),["assets/Login.d70200f1.js","assets/vendor.b2c28a85.js"]),meta:{title:"\u767B\u5F55/\u6CE8\u518C"}},{path:"/courses",component:()=>y(()=>import("./Courses.2f816fdb.js"),["assets/Courses.2f816fdb.js","assets/UserBrief.494b4d44.js","assets/vendor.b2c28a85.js","assets/index.d7c2533d.js"]),meta:{title:"\u9009\u8BFE",needAuth:!0}},{path:"/profile",component:()=>y(()=>import("./Profile.5229604d.js"),["assets/Profile.5229604d.js","assets/ProfileEditor.380ad268.js","assets/UserBrief.494b4d44.js","assets/vendor.b2c28a85.js"]),meta:{title:"\u4E2A\u4EBA\u4FE1\u606F",needAuth:!0}},{path:"/users",component:()=>y(()=>import("./Users.22c70709.js"),["assets/Users.22c70709.js","assets/vendor.b2c28a85.js","assets/ProfileEditor.380ad268.js","assets/UserBrief.494b4d44.js"]),meta:{title:"\u7528\u6237\u7BA1\u7406",needAuth:!0,role:[_.Admin]}}]});x.beforeEach((e,t,s)=>{document.title=`Qiaqia\u9009\u8BFE\u7CFB\u7EDF | ${e.meta.title}`,e.meta.needAuth?l.state.loginToken?(e.path===v?s("/"):s(),l.dispatch("fetchUserInfo").then(()=>{var a;e.meta.role!==void 0&&!e.meta.role.includes((a=l.state.user)==null?void 0:a.role)&&(console.log("\u5F53\u524D\u65E0\u6743\u8BBF\u95EE\u5BF9\u5E94\u9875\u9762"),l.commit("saveRouterPushReason","\u60A8\u7684\u8EAB\u4EFD\u4E0D\u7B26\u5408\u6B64\u9875\u9762\u7684\u8BBF\u95EE\u6743\u9650"),x.push("/"))}).catch(()=>{l.commit("login/setLoginReason","\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25\uFF0C\u9700\u8981\u91CD\u65B0\u767B\u5F55\u3002"),x.push({path:v,query:{redirect:e.fullPath}})}),l.dispatch("fetchSemesters").finally(()=>{var a;((a=l.state.user)==null?void 0:a.role)!==_.Admin&&l.dispatch("fetchSchedules")})):(l.commit("login/setLoginReason","\u9700\u8981\u767B\u5F55\u624D\u80FD\u8BBF\u95EE\u6B64\u9875\u9762\u3002"),s({path:v,query:{redirect:e.fullPath}})):s()});we(Ce).use(l,I).use(x).mount("#app");export{xe as D,_ as R,d as a,be as b,Ue as d,Fe as i};
